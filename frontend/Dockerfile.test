# Multi-stage build pour le frontend avec tests
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

# Stage de test
FROM node:18-alpine as test

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .

# Configuration pour les tests
ENV CI=true
ENV REACT_APP_API_URL=http://localhost:8000

# Commande par d√©faut pour les tests
CMD ["npm", "test", "--", "--coverage", "--watchAll=false"]